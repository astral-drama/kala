# Kala Time Server Configuration for Chrony
# This configuration sets up the system as both an NTP client and server

# Use public NTP servers from the pool.ntp.org project
# Using multiple servers for redundancy and accuracy
pool 0.pool.ntp.org iburst maxsources 2
pool 1.pool.ntp.org iburst maxsources 2
pool 2.pool.ntp.org iburst maxsources 2
pool 3.pool.ntp.org iburst maxsources 2

# Use Debian's NTP server as additional source
server ntp.debian.org iburst

# Record the rate at which the system clock gains/losses time
driftfile /var/lib/chrony/chrony.drift

# Allow the system clock to be stepped in the first three updates
# if its offset is larger than 1 second
makestep 1.0 3

# Enable kernel synchronization of the real-time clock
rtcsync

# Allow NTP client access from local network
# Adjust these ranges to match your local network
allow 192.168.0.0/16
allow 10.0.0.0/8
allow 172.16.0.0/12
allow fe80::/10

# Serve time even if not synchronized to a time source
local stratum 10

# Specify file containing keys for NTP authentication
keyfile /etc/chrony/chrony.keys

# Log files location
logdir /var/log/chrony

# Log tracking measurements, statistics, and RTC
log tracking measurements statistics rtc

# Save data between restarts for faster re-sync
dumponexit
dumpdir /var/lib/chrony

# Use hardware timestamping on all interfaces that support it
hwtimestamp *

# Increase the minimum number of selectable sources required to adjust
# the system clock (for better accuracy)
minsources 2

# Limit memory use for clients
clientloglimit 16777216